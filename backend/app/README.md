# RouterAgent API ì‹œìŠ¤í…œ

GPT-4o ê¸°ë°˜ 4ë¶„ë¥˜ ìë™ ë¼ìš°íŒ… ì‹œìŠ¤í…œì„ ìœ„í•œ í†µí•© FastAPI ì„œë²„

## ê°œìš”

ì´ ì‹œìŠ¤í…œì€ ë‹¤ìŒ 4ê°€ì§€ ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤:
- ìë™ ë¼ìš°íŒ…
- ë¬¸ì„œ ë¶„ë¥˜ ë° ì´ˆì•ˆ ì‘ì„±
- ì§ì› ì‹¤ì  ë¶„ì„
- ê±°ë˜ì²˜ ë¶„ì„

## ì‹¤í–‰ ì „ ì„¤ì •

`backend/app/` ë””ë ‰í† ë¦¬ì—ì„œ `.env` íŒŒì¼ì„ ìƒì„±í•˜ê³  ë‹¤ìŒ ë‚´ìš©ì„ ì¶”ê°€:

```
OPENAI_API_KEY=your_openai_api_key_here
```

## ì„œë²„ ì‹¤í–‰

```bash
cd backend/app
python main.py
```

ì„œë²„ëŠ” `http://0.0.0.0:8000`ì—ì„œ ì‹¤í–‰ë©ë‹ˆë‹¤.

## API ì—”ë“œí¬ì¸íŠ¸

### 1. ë©”ì¸ ì—”ë“œí¬ì¸íŠ¸

**GET /**
- **ì„¤ëª…**: ì„œë²„ ìƒíƒœ í™•ì¸
- **ì‘ë‹µ**: `{"message": "ğŸš€ RouterAgent API is running!"}`

### 2. ë¼ìš°í„° API (`/api/route`)

**POST /api/route/router**
- **ì„¤ëª…**: ì‚¬ìš©ì ì¿¼ë¦¬ë¥¼ ì ì ˆí•œ ì—ì´ì „íŠ¸ë¡œ ë¼ìš°íŒ…
- **ì…ë ¥**:
  ```json
  {
    "query": "ì§ì› ì‹¤ì ì„ ë¶„ì„í•´ì£¼ì„¸ìš”"
  }
  ```
- **ì¶œë ¥**: ë¼ìš°íŒ… ê²°ê³¼ ë° ì—ì´ì „íŠ¸ë³„ ì²˜ë¦¬ ê²°ê³¼

### 3. ë¬¸ì„œ API (`/api/docs`)

**POST /api/docs/classify** (ë ˆê±°ì‹œ)
- **ì„¤ëª…**: ë¬¸ì„œ ë¶„ë¥˜
- **ì…ë ¥**:
  ```json
  {
    "user_input": "ê³„ì•½ì„œ ì´ˆì•ˆì„ ì‘ì„±í•´ì£¼ì„¸ìš”"
  }
  ```
- **ì¶œë ¥**:
  ```json
  {
    "success": true,
    "state": {
      "doc_type": "ì˜ì—…ë°©ë¬¸ ê²°ê³¼ë³´ê³ ì„œ",
      "template_content": "í…œí”Œë¦¿ ë‚´ìš©..."
    },
    "error": null
  }
  ```

**POST /api/docs/write** (ë ˆê±°ì‹œ)
- **ì„¤ëª…**: ë¬¸ì„œ ì´ˆì•ˆ ì‘ì„±
- **ì…ë ¥**:
  ```json
  {
    "state": {
      "doc_type": "ì˜ì—…ë°©ë¬¸ ê²°ê³¼ë³´ê³ ì„œ"
    },
    "user_input": "ë°©ë¬¸ì¼ì‹œ: 2024-01-15, ê³ ê°ì‚¬: ABCíšŒì‚¬..."
  }
  ```
- **ì¶œë ¥**:
  ```json
  {
    "success": true,
    "filled_data": {
      "title": "ì˜ì—…ë°©ë¬¸ ê²°ê³¼ë³´ê³ ì„œ",
      "content": "ë¬¸ì„œ ë‚´ìš©..."
    },
    "error": null
  }
  ```

**POST /api/docs/interactive** â­ (ìƒˆë¡œìš´ ìƒí˜¸ì‘ìš© ë°©ì‹)
- **ì„¤ëª…**: ì‚¬ìš©ìì™€ ìƒí˜¸ì‘ìš©í•˜ëŠ” ë¬¸ì„œ ì‘ì„± ì²˜ë¦¬
- **ì´ˆê¸° ìš”ì²­ (ë¶„ë¥˜)**:
  ```json
  {
    "session_id": "session_123",
    "user_input": "ì˜ì—…ë°©ë¬¸ ê²°ê³¼ë³´ê³ ì„œë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”",
    "is_initial": true
  }
  ```
- **ì´ˆê¸° ì‘ë‹µ**:
  ```json
  {
    "success": true,
    "stage": "waiting_input",
    "message": "ğŸ“„ ì˜ì—…ë°©ë¬¸ ê²°ê³¼ë³´ê³ ì„œ ì‘ì„±ì„ ì‹œì‘í•©ë‹ˆë‹¤. ë‹¤ìŒ ì •ë³´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”:",
    "doc_type": "ì˜ì—…ë°©ë¬¸ ê²°ê³¼ë³´ê³ ì„œ",
    "template": "ã€ê¸°ë³¸ ì •ë³´ã€‘\n- ë°©ë¬¸ ì œëª©:\n- Client(ê³ ê°ì‚¬ëª…):\n...",
    "requires_user_input": true
  }
  ```
- **í›„ì† ìš”ì²­ (ë¬¸ì„œ ì‘ì„±)**:
  ```json
  {
    "session_id": "session_123",
    "user_input": "ë°©ë¬¸ ì œëª©: ì‹ ì œí’ˆ ì†Œê°œ\nClient: ABCë³‘ì›\në‹´ë‹¹ì: ê¹€ì˜ì‚¬...",
    "is_initial": false
  }
  ```
- **ì™„ë£Œ ì‘ë‹µ**:
  ```json
  {
    "success": true,
    "stage": "completed",
    "message": "ğŸ“„ ì˜ì—…ë°©ë¬¸ ê²°ê³¼ë³´ê³ ì„œ ì‘ì„±ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!",
    "doc_type": "ì˜ì—…ë°©ë¬¸ ê²°ê³¼ë³´ê³ ì„œ",
    "document": {
      "ë°©ë¬¸_ì œëª©": "ì‹ ì œí’ˆ ì†Œê°œ",
      "Client": "ABCë³‘ì›",
      "ë‹´ë‹¹ì": "ê¹€ì˜ì‚¬"
    },
    "session_completed": true
  }
  ```

**GET /api/docs/status/{session_id}**
- **ì„¤ëª…**: ë¬¸ì„œ ì‘ì„± ì„¸ì…˜ ìƒíƒœ ì¡°íšŒ
- **ì¶œë ¥**:
  ```json
  {
    "session_id": "session_123",
    "stage": "waiting_input",
    "doc_type": "ì˜ì—…ë°©ë¬¸ ê²°ê³¼ë³´ê³ ì„œ",
    "has_template": true,
    "input_count": 1,
    "is_completed": false,
    "has_error": false,
    "error_message": null
  }
  ```

**POST /api/docs/reset/{session_id}**
- **ì„¤ëª…**: ë¬¸ì„œ ì‘ì„± ì„¸ì…˜ ë¦¬ì…‹
- **ì¶œë ¥**:
  ```json
  {
    "success": true,
    "message": "ì„¸ì…˜ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤. ìƒˆë¡œìš´ ë¬¸ì„œ ì‘ì„±ì„ ì‹œì‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.",
    "session_id": "session_123",
    "stage": "initial"
  }
  ```

### 4. ì§ì› ë¶„ì„ API (`/api/employee`) â­ (ëŒ€í­ ê°œì„ )

**GET /api/employee/health**
- **ì„¤ëª…**: Employee Agent í—¬ìŠ¤ ì²´í¬ ë° ì‹œìŠ¤í…œ ìƒíƒœ í™•ì¸
- **ì¶œë ¥**:
  ```json
  {
    "status": "healthy",
    "agent": "Enhanced Employee Performance Agent",
    "database_status": "connected",
    "available_employees": ["ìµœìˆ˜ì•„", "ì¡°ì‹œí˜„"],
    "total_employees": 2,
    "features": [
      "ìë™ ì¿¼ë¦¬ ë¶„ì„",
      "SQLite ê¸°ë°˜ ë°ì´í„° ì²˜ë¦¬",
      "ê³ ê¸‰ í†µê³„ ë¶„ì„",
      "LLM ê¸°ë°˜ ë³´ê³ ì„œ",
      "ì¢…í•© í‰ê°€ ì‹œìŠ¤í…œ"
    ]
  }
  ```

**GET /api/employee/employees**
- **ì„¤ëª…**: ì‚¬ìš© ê°€ëŠ¥í•œ ì§ì› ëª©ë¡ ì¡°íšŒ
- **ì¶œë ¥**:
  ```json
  {
    "success": true,
    "employees": ["ìµœìˆ˜ì•„", "ì¡°ì‹œí˜„"],
    "count": 2,
    "message": "2ëª…ì˜ ì§ì› ë°ì´í„°ê°€ ìˆìŠµë‹ˆë‹¤."
  }
  ```

**POST /api/employee/analyze** â­ (ì™„ì „ ê°œì„ )
- **ì„¤ëª…**: ì§€ëŠ¥í˜• ì§ì› ì‹¤ì  ë¶„ì„ (ìë™ ì¿¼ë¦¬ íŒŒì‹±)
- **ì…ë ¥**:
  ```json
  {
    "session_id": "session_123",
    "query": "ìµœìˆ˜ì•„ì˜ 2023ë…„ 12ì›”ë¶€í„° 2024ë…„ 3ì›”ê¹Œì§€ ì‹¤ì  ë¶„ì„í•´ì£¼ì„¸ìš”"
  }
  ```
- **ì¶œë ¥**:
  ```json
  {
    "success": true,
    "employee_name": "ìµœìˆ˜ì•„",
    "period": "202312~202403",
    "total_performance": 15000000,
    "achievement_rate": 125.5,
    "evaluation": "ìš°ìˆ˜",
    "report": "ğŸ“Š ì§ì› ì‹¤ì  ë¶„ì„ ë³´ê³ ì„œ\n\n1. ì‹¤í–‰ ìš”ì•½\në¶„ì„ ê²°ê³¼ ì´ 15,000,000ì›ì˜ ì‹¤ì ì„ ë‹¬ì„±í•˜ì˜€ìœ¼ë©°...",
    "analysis_details": {
      "comprehensive_evaluation": {
        "total_score": 85,
        "grade": "A",
        "grade_description": "ìš°ìˆ˜",
        "score_breakdown": {
          "achievement": 40,
          "trend": 25,
          "stability": 16,
          "concentration": 8
        },
        "strengths": ["ëª©í‘œ ë‹¬ì„±ë¥  ìš°ìˆ˜", "ì„±ì¥ ì¶”ì„¸ ì–‘í˜¸"],
        "weaknesses": []
      },
      "detailed_trend": {
        "trend": "ìƒìŠ¹",
        "slope": 125.5,
        "trend_strength": "ê°•í•¨",
        "prediction": 1650000
      },
      "product_pareto": {
        "total_items": 15,
        "pareto_point": 3,
        "pareto_efficiency": "ìƒìœ„ 3ê°œ í•­ëª©ì´ ì „ì²´ì˜ 80% ì°¨ì§€"
      },
      "forecast": {
        "method": "ê°€ì¤‘ í‰ê·  (ì„ í˜•íšŒê·€ + ì´ë™í‰ê· )",
        "forecast": [1650000, 1720000, 1780000],
        "confidence": "ë†’ìŒ"
      }
    },
    "message": "ì‹¤ì  ë¶„ì„ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤."
  }
  ```

**POST /api/employee/analyze-detailed**
- **ì„¤ëª…**: ìƒì„¸ íŒŒë¼ë¯¸í„°ë¥¼ ì§€ì›í•˜ëŠ” ë¶„ì„
- **ì…ë ¥**:
  ```json
  {
    "session_id": "session_123",
    "query": "ì‹¤ì  ë¶„ì„í•´ì£¼ì„¸ìš”",
    "employee_name": "ìµœìˆ˜ì•„",
    "period": "202312~202403",
    "analysis_type": "ì¢…í•©ë¶„ì„"
  }
  ```

## ìƒˆë¡œìš´ Employee Agent ì£¼ìš” ê¸°ëŠ¥

### ğŸ” **ìë™ ì¿¼ë¦¬ ë¶„ì„**
- **ìì—°ì–´ ì²˜ë¦¬**: "ìµœìˆ˜ì•„ì˜ ì‘ë…„ ì‹¤ì  ì–´ë–¤ê°€ìš”?" â†’ ìë™ìœ¼ë¡œ ì§ì›ëª…, ê¸°ê°„ ì¶”ì¶œ
- **LLM ê¸°ë°˜ íŒŒì‹±**: OpenAIë¥¼ í™œìš©í•œ ì •í™•í•œ ì˜ë„ íŒŒì•…
- **ê¸°ë³¸ê°’ ì„¤ì •**: ëˆ„ë½ëœ ì •ë³´ ìë™ ë³´ì™„

### ğŸ—„ï¸ **SQLite ê¸°ë°˜ ë°ì´í„° ì²˜ë¦¬**
- **ì‹¤ì  ë°ì´í„°**: `performance_swest_sua.sqlite`ì—ì„œ ì›”ë³„ ì‹¤ì  ì¡°íšŒ
- **ëª©í‘œ ë°ì´í„°**: `joonpharma_target.sqlite`ì—ì„œ ëª©í‘œ ì •ë³´ ì¡°íšŒ
- **ë™ì  ì¿¼ë¦¬**: ì¡°ê±´ì— ë”°ë¥¸ ìœ ì—°í•œ ë°ì´í„° í•„í„°ë§

### ğŸ“Š **ê³ ê¸‰ ê³„ì‚° ë„êµ¬**
- **íŠ¸ë Œë“œ ë¶„ì„**: ì„ í˜•íšŒê·€, RÂ² ê³„ì‚°, ì˜ˆì¸¡ê°’ ìƒì„±
- **íŒŒë ˆí†  ë¶„ì„**: 80-20 ë²•ì¹™ ê¸°ë°˜ ì œí’ˆ/ê±°ë˜ì²˜ ì§‘ì¤‘ë„ ë¶„ì„
- **ë¶„ì‚° ë¶„ì„**: ë³€ë™ê³„ìˆ˜(CV), ì•ˆì •ì„± í‰ê°€
- **ê³„ì ˆì„± ë¶„ì„**: ì›”ë³„ íŒ¨í„´ ë° ê³„ì ˆì„± ì§€ìˆ˜
- **ìƒê´€ê´€ê³„ ë¶„ì„**: í”¼ì–´ìŠ¨ ìƒê´€ê³„ìˆ˜
- **ì˜ˆì¸¡ ë¶„ì„**: ì´ë™í‰ê·  + ì„ í˜•íšŒê·€ ê²°í•©

### ğŸ¯ **ì¢…í•© í‰ê°€ ì‹œìŠ¤í…œ**
- **ì ìˆ˜ ì²´ê³„**: 100ì  ë§Œì  (ëª©í‘œë‹¬ì„± 40ì , íŠ¸ë Œë“œ 30ì , ì•ˆì •ì„± 20ì , ì§‘ì¤‘ë„ 10ì )
- **ë“±ê¸‰ ë¶„ë¥˜**: S(íƒì›”), A(ìš°ìˆ˜), B(ì–‘í˜¸), C(ë³´í†µ), D(ê°œì„ í•„ìš”)
- **ê°•ì /ì•½ì  ì‹ë³„**: ìë™ ë¶„ì„ ë° ê°œì„  ìš°ì„ ìˆœìœ„ ì œì•ˆ

### ğŸ“ **LLM ê¸°ë°˜ ë³´ê³ ì„œ**
- **ì§€ëŠ¥í˜• ë³´ê³ ì„œ**: GPTë¥¼ í™œìš©í•œ ì „ë¬¸ì ì´ê³  ì‹¤í–‰ ê°€ëŠ¥í•œ ì¸ì‚¬ì´íŠ¸
- **êµ¬ì¡°í™”ëœ í˜•ì‹**: ì‹¤í–‰ìš”ì•½, ì„±ê³¼ë¶„ì„, íŠ¸ë Œë“œì˜ˆì¸¡, ê°œì„ ë°©ì•ˆ
- **í´ë°± ì‹œìŠ¤í…œ**: LLM ì‹¤íŒ¨ì‹œ ê¸°ë³¸ ë³´ê³ ì„œ ìë™ ìƒì„±

### ğŸ”§ **ì‚¬ìš© ì˜ˆì‹œ**

```python
# í…ŒìŠ¤íŠ¸ ì‹¤í–‰
python backend/app/services/employee_agent/test_enhanced_agent.py

# ë‹¤ì–‘í•œ ì¿¼ë¦¬ ì˜ˆì‹œ
"ìµœìˆ˜ì•„ì˜ ì‹¤ì ì„ ë¶„ì„í•´ì£¼ì„¸ìš”"
"2023ë…„ 12ì›”ë¶€í„° 2024ë…„ 3ì›”ê¹Œì§€ íŠ¸ë Œë“œ ë¶„ì„"
"ëª©í‘œ ë‹¬ì„±ë¥ ê³¼ ì œí’ˆë³„ ì„±ê³¼ ë³´ê³ ì„œ ë§Œë“¤ì–´ì¤˜"
"ì§ì› ì„±ê³¼ í‰ê°€í•˜ê³  ê°œì„  ë°©ì•ˆ ì œì•ˆí•´ì¤˜"
```

### ğŸ“‹ **ë°ì´í„°ë² ì´ìŠ¤ êµ¬ì¡°**

**performance_swest_sua.sqlite (ì‹¤ì  ë°ì´í„°)**
```sql
CREATE TABLE sales_performance (
  ë‹´ë‹¹ì TEXT,
  ID TEXT,        -- ê±°ë˜ì²˜ëª…
  í’ˆëª© TEXT,      -- ì œí’ˆëª…
  ë…„ì›” INTEGER,   -- YYYYMM
  ì‹¤ì ê¸ˆì•¡ REAL   -- íŒë§¤ê¸ˆì•¡
);
```

**joonpharma_target.sqlite (ëª©í‘œ ë°ì´í„°)**
```sql
CREATE TABLE monthly_target (
  ì§€ì  TEXT,
  ë‹´ë‹¹ì TEXT,
  ë…„ì›” INTEGER,
  ëª©í‘œ REAL
);
```

### 5. ê±°ë˜ì²˜ ë¶„ì„ API (`/api/client`)

**GET /api/client/health**
- **ì„¤ëª…**: Client Agent í—¬ìŠ¤ ì²´í¬
- **ì¶œë ¥**:
  ```json
  {
    "status": "healthy",
    "agent": "Client Analysis Agent",
    "service": "running"
  }
  ```

**POST /api/client/analyze**
- **ì„¤ëª…**: ê±°ë˜ì²˜ ë¶„ì„
- **ì…ë ¥**:
  ```json
  {
    "name": "ABC íšŒì‚¬",
    "sales": 50000000,
    "visits": 12
  }
  ```
- **ì¶œë ¥**:
  ```json
  {
    "success": true,
    "data": {
      "ë“±ê¸‰": "A",
      "ë“±ê¸‰ ì´ìœ ": "ë†’ì€ ë§¤ì¶œê³¼ ì•ˆì •ì ì¸ ë°©ë¬¸ íšŸìˆ˜",
      "ì˜ì—… ì „ëµ ë³´ê³ ì„œ": "ì˜ì—… ì „ëµ ìƒì„¸ ë‚´ìš©...",
      "ì„±ì¥ ìš”ì•½ ë³´ê³ ì„œ": "ì„±ì¥ ë¶„ì„ ë‚´ìš©...",
      "í†µí•© ë³´ê³ ì„œ": "ì „ì²´ ë¶„ì„ ê²°ê³¼..."
    },
    "message": "í´ë¼ì´ì–¸íŠ¸ ë¶„ì„ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤."
  }
  ```

**POST /api/client/run-report**
- **ì„¤ëª…**: ë ˆê±°ì‹œ í˜¸í™˜ì„±ì„ ìœ„í•œ ì—”ë“œí¬ì¸íŠ¸
- **ì…ë ¥**: analyzeì™€ ë™ì¼
- **ì¶œë ¥**: analyzeì˜ data ë¶€ë¶„ë§Œ ë°˜í™˜

## íŒŒì¼ êµ¬ì¡°

```
main.py - ëª¨ë“  FastAPI ì‹¤í–‰íŒŒì¼ (í†µí•© ì„œë²„)
â”œâ”€â”€ /api/client_api.py - ê±°ë˜ì²˜ë¶„ì„ FastAPI ì‹¤í–‰íŒŒì¼
â”œâ”€â”€ /api/docs_api.py - ë¬¸ì„œì´ˆì•ˆì‘ì„± FastAPI ì‹¤í–‰íŒŒì¼  
â”œâ”€â”€ /api/employee_api.py - ì‹¤ì ë¶„ì„ FastAPI ì‹¤í–‰íŒŒì¼
â”œâ”€â”€ /api/router_api.py - ë¼ìš°í„° FastAPI ì‹¤í–‰íŒŒì¼
â””â”€â”€ /services/ # ë¼ìš°í„° ë° 3ê°œì˜ ì—ì´ì „íŠ¸ ì†ŒìŠ¤íŒŒì¼ ( API ì—°ê²° )
    â”œâ”€â”€ /client_agent/client_analysis_agent.py - ê±°ë˜ì²˜ë¶„ì„ ì†ŒìŠ¤ì½”ë“œ
    â”œâ”€â”€ /docs_agent/
    â”‚   â”œâ”€â”€ classify_docs.py - ë¬¸ì„œ ë¶„ë¥˜ ì†ŒìŠ¤ì½”ë“œ
    â”‚   â”œâ”€â”€ test_api.py - ë¬¸ì„œ ë¶„ë¥˜ë¶€í„° ì´ˆì•ˆì‘ì„±ê¹Œì§€ ì˜ˆì‹œ ì‹¤í–‰ ì½”ë“œ
    â”‚   â””â”€â”€ write_docs.py - ë¬¸ì„œ ì´ˆì•ˆ ì‘ì„± ì†ŒìŠ¤ì½”ë“œ
    â”œâ”€â”€ /employee_agent/employee_agent.py - ì‹¤ì ë¶„ì„ ì†ŒìŠ¤ì½”ë“œ
    â””â”€â”€ /router_agent/state_graph_router.py - ë¼ìš°í„° ìŠ¤í…Œì´íŠ¸ ê·¸ë˜í”„ ì†ŒìŠ¤ì½”ë“œ
```

## API ë¬¸ì„œ

ì„œë²„ ì‹¤í–‰ í›„ ë‹¤ìŒ URLì—ì„œ ìë™ ìƒì„±ëœ API ë¬¸ì„œë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:
- Swagger UI: `http://localhost:8000/docs`
- ReDoc: `http://localhost:8000/redoc`